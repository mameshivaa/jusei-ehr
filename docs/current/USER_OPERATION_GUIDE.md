# ユーザー向け説明書（完全版）

最終更新: 2026-02-15
対象バージョン: v0.1.0（現行実装準拠）

この文書は、接骨院スタッフが V-OSS を日常運用するための完全版マニュアルです。

## 1. この説明書の対象

- 対象ユーザー
  - 受付（RECEPTION）
  - 施術者（PRACTITIONER）
  - 管理者（ADMIN）
- 対象範囲
  - 初回セットアップ
  - 日常業務（受付、患者、カルテ、施術録）
  - 管理者運用（ユーザー、バックアップ、データ入出力、ログ、拡張）

## 2. 起動とログイン

### 2.1 初回起動時

- 初回は自動的に `セットアップ` 画面が開きます。
- セットアップ完了後、`ようこそ` 画面からログイン画面へ進みます。

### 2.2 ログイン方法

- ログインは `ユーザーID / パスワード` 方式です。
- ログインIDはセットアップ時または管理者作成時の ID です。
- 入力後 `ログイン` を押します。

### 2.3 管理者パスワード再設定（復旧）

- ログイン画面の `管理者パスワードの再設定` を開きます。
- `復旧コード` と `新しいパスワード`（4文字以上）を入力して再設定します。
- 再設定成功時、管理者IDが画面に反映されます。

## 3. 初回セットアップ（7ステップ）

セットアップは次の順で進みます。

1. PC端末の暗号化
- FileVault/BitLocker など、OSのディスク暗号化を有効にして確認します。

2. 安全管理責任者
- 役職、氏名（姓・名）を入力します。

3. 管理者ログイン
- 役職、氏名、管理者ID、パスワードを設定します。
- `安全管理責任者と兼任` にもできます。
- パスワードは4文字以上です。

4. 運用体制
- 事故連絡、バックアップ、BCP、ログ管理などの運用確認に同意します。

5. バックアップ
- バックアップ保存先を確認します。
- `BACKUP_SECRET`（8文字以上）を設定します。

6. PW紛失時
- 管理者復旧コードが発行されます。
- 必ず安全な場所に保存し、保存確認チェックを入れます。

7. 重要事項
- プライバシーポリシー・利用規約を最後まで確認し、同意します。

完了時に `セットアップを完了` を押すと、ウェルカム画面へ進みます。

## 4. 画面の基本構成

上部メニュー（主要ナビ）
- `ホーム`
- `来院受付`
- `カルテ管理`
- `患者管理`
- `ログ`
- `設定`

右上
- ログインユーザー名
- ロール表示
- ログアウト

## 5. 日常業務の標準フロー

1. 来院受付で患者を受付する
2. 必要に応じて患者情報を更新する
3. カルテ管理で該当カルテを開く
4. 施術録を記載する
5. 必要に応じて記録を確定する
6. ログで操作履歴を確認する（必要時）

## 6. 来院受付の使い方

### 6.1 受付タブ

- 患者ID/かな/氏名で検索できます。
- 各行の `受付登録` でチェックインします。
- `カルテ概要` でカルテ内容を確認できます。
- 当日受付済み件数・未受付件数を確認できます。

### 6.2 記載待ちタブ

- 当日分の `未記載施術録` を一覧表示します。
- `施術録記載` からそのまま記録入力できます。
- `受付取消` で受付を取り消せます。

## 7. 患者管理の使い方

### 7.1 患者検索

- `検索（氏名 / フリガナ / 患者ID）` で絞り込みます。

### 7.2 新規患者登録

- `新規患者登録` を押します。
- 主な必須項目
  - ID
  - 氏名（姓・名）
  - フリガナ（セイ・メイ、全角カタカナ）
- 任意項目
  - 生年月日、性別
  - 電話、メール
  - 郵便番号、都道府県、市区町村、住所
  - メモ
- `そのまま作成した患者にカルテを作成する` を選べます。

### 7.3 患者詳細

- `患者情報` から詳細モーダルを開けます。
- 確認できる内容
  - 基本情報
  - 既存カルテ一覧
  - 来院履歴
  - 負傷エピソード
- `編集` で患者情報を更新できます。

### 7.4 患者削除

- 削除理由の入力が必須です。
- 2段階確認（3秒カウント）後に実行されます。
- Electron版では削除前バックアップ作成を選択できます。
- 削除後30秒は `取り消す` が可能です。

## 8. カルテ管理の使い方

### 8.1 カルテ検索・絞り込み

- 患者名/カナ/患者IDで検索できます。
- 状態フィルタ
  - 通院中
  - 治癒
  - 中止
  - 転医

### 8.2 新規カルテ作成

- `新規カルテ作成` を押します。
- 患者を選択してカルテ情報を入力します。
- 新規カルテ作成時は以下を入力します。
  - 初検日（必須）
  - 負傷日（必須）
  - 負傷名（1件以上、複数可）
  - 必要に応じて病名自由記述
  - 保険種別（必須）
  - 必要に応じて保険証情報
- `そのまま作成したカルテの施術録を記入する` を選択できます。

### 8.3 カルテ概要

- `カルテ概要` で次を確認できます。
  - 患者情報、保険、状態、初検日
  - 施術録プレビュー（並び替え可）

### 8.4 PDFプレビュー

- `PDFプレビュー` タブで次を実行できます。
  - 再読み込み
  - 印刷
  - ダウンロード
- 右側で `PDF出力設定` を変更できます。

### 8.5 カルテ削除

- 患者削除と同様に、理由入力 + 2段階確認が必要です。
- 削除後30秒は取り消しできます。

## 9. 施術録の作成・編集・確定

### 9.1 作成入口

- 来院詳細画面の `施術記録を追加`
- カルテ管理/来院受付の `施術録記載`

### 9.2 入力項目

- 負傷エピソード（通常は選択必須）
- 記録内容（自由記述）
- 施術明細（施術、部位、数量）
- 編集時は `訂正理由` が必須

### 9.3 テンプレート

- 記録内容をテンプレートとして保存できます。
- 保存済みテンプレートを再適用できます。

### 9.4 確定

- 未確定記録は `確定` が可能です（理由入力必須）。
- 確定済みは編集不可になります。

### 9.5 詳細確認

- 記録詳細で次を確認できます。
  - 作成/更新日時
  - 記録本文
  - 作成者/確定者
  - 更新履歴（CREATE/UPDATE/DELETE/CONFIRM/RESTORE）

## 10. ログ画面

### 10.1 カルテ操作ログ

- 操作種別、期間でフィルタ可能です。
- CSV出力できます。

### 10.2 監査ログ（管理者のみ）

- 対象/操作/期間でフィルタできます。
- CSV出力できます。

## 11. 設定（管理者向け）

`設定` は主に管理者向け機能です。

### 11.1 設定トップ（`/settings`）

タブ: `アカウント` / `バックアップ`

アカウント
- スタッフ追加（受付/柔整師/管理者）
- ロール変更
- 状態変更（有効/停止/削除）
- パスワード再設定
- ロック解除
- 削除
- 復旧コード再発行（MFAコード必須）

バックアップ
- 今すぐバックアップ
- 過去バックアップ再取り込み
- 外部保存（ダウンロード）
- 復元（確認文字 `復元` 入力が必要）
- 保存先状態・欠落アラート確認

### 11.2 システム設定（`/settings/system`）

- システム文書へのリンク
- バージョン情報/更新確認

### 11.3 ユーザー管理（`/settings/users`）

- ユーザー一覧
- ロール/状態変更
- ロック解除
- パスワード再設定

### 11.4 データエクスポート（`/settings/data-export`）

- 形式: JSON / CSV / XML / SQL
- 対象: 患者、来院、施術記録（JSONはユーザー/監査ログも選択可）
- 日付範囲フィルタ
- ZIP暗号化（推奨、パスワード8文字以上）

### 11.5 データインポート（`/settings/data-import`）

- 形式: JSON / CSV / XML
- SQLインポートは画面からは無効（手動運用）

### 11.6 PDF設定（`/settings/pdf-preview`）

- 出力項目のON/OFF
  - カルテ概要
  - 施術録ヘッダー
  - 施術録本文

### 11.7 代行操作承認（`/settings/proxy-operations`）

- 承認待ちの代行操作を承認/却下

### 11.8 代表Googleアカウント（`/settings/representative`）

- 代表アカウントメールを変更
- 変更時に旧セッションを無効化

### 11.9 拡張機能（`/settings/extensions`）

- 同期アドオンのセットアップ（共有手段、テナントID、接続先URL、共有シークレット）
- 「保存して接続テスト」による導入確認
- 外部同期アドオンの接続状態表示（接続中/無効/接続不可/権限不足）
- 同期世代一覧の更新
- 管理者による「この世代を最新化」（ロールバック）
- インストール済み拡張の有効化/無効化
- 権限の付与/剥奪
- 拡張再読み込み
- テンプレート印刷の呼び出し

### 11.10 マーケットプレイス（`/marketplace`）

- 公式カタログの拡張を閲覧
- 管理者はインストール/更新/削除可能（管理者パスワード確認あり）

## 12. ロール別にできること

### 12.1 受付（RECEPTION）

- 患者: 閲覧/作成/更新
- カルテ: 閲覧/作成
- 来院: 閲覧/作成
- 施術記録: 閲覧のみ
- 管理者機能（ユーザー管理、監査ログ、設定変更など）は不可

### 12.2 施術者（PRACTITIONER）

- 患者: 閲覧/作成/更新
- カルテ: 閲覧/作成/更新
- 来院: 閲覧/作成/更新
- 施術記録: 閲覧/作成/更新
- 管理者機能は不可

### 12.3 管理者（ADMIN）

- 全機能にアクセス可能
- ユーザー、設定、バックアップ、監査ログ、緊急操作を実行可能

## 13. よくあるトラブルと対処

### 13.1 ログインできない

- ID/パスワードの入力ミスを確認
- アカウント停止・ロックの可能性があるため管理者に確認
- 管理者本人は復旧コードで再設定可能

### 13.2 保存できない

- 読み取り専用モード/メンテナンス中の可能性があります
- 画面上部やオーバーレイの通知を確認

### 13.3 施術録を編集できない

- 確定済み記録は編集不可です
- 未確定記録で編集してください

### 13.4 バックアップ復元ができない

- 確認文字 `復元` を正確に入力
- 復元中はアプリ再起動を待機
- 失敗時は最新バックアップを再確認

### 13.5 PDFに必要な項目が出ない

- `設定 > PDFプレビュー設定` で出力項目を有効化
- カルテPDFプレビューを再読み込み

## 14. 安全運用チェックリスト

- 毎日
  - ログインアカウントの共有を避ける
  - 受付・記録漏れがないか確認する
- 毎週
  - バックアップを外部保存する
  - 復旧コードの保管状態を確認する
- 毎月
  - ログ（カルテ操作/監査）を点検する
  - 不要なアカウントや権限を見直す

## 15. 同期アドオン運用時の注意

- `設定 > 拡張機能管理` に「同期フォルダアドオン（外部アドオン）」カードが表示されます。
- 同カードで `接続中 / 無効 / 接続不可 / 権限不足` の状態を確認できます。
- 同期アドオン導入院では、編集画面で「同期ロック取得中」と表示される場合があります。
- ほかの端末で同時に編集が始まっている場合、保存ボタンは無効化されます。
- 同期異常時は自動で保存停止（閲覧モード）へ遷移します。
- この状態では編集を続けず、管理者へ連絡してください。
- 管理者は `SYNC_EXTENSION_ENABLED` を一時的に `false` にして本体単独運用へ退避できます。

### 15.1 利用者の操作シーケンス（同期有効時）

1. 編集画面を開くと、アプリが自動で編集ロック取得を試行します。
2. ロック取得に失敗した場合は、編集不可メッセージが表示されます。
3. 保存時はローカル保存後に同期コミットが自動実行されます。
4. 画面離脱や保存完了時にロックが自動解放されます。

## 16. 補足

- 施術録記載モーダルでは `Ctrl+S` / `Cmd+S` で保存できます。
- 詳細な統制・監査文書は `システム文書` 画面（`/docs`）を参照してください。
