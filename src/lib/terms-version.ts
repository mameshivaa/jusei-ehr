import { createHash } from "crypto";

type ConsentDocument = {
  version: string;
  hash: string;
  text: string;
};

const TERMS_VERSION = "2026-02-20";
const PRIVACY_VERSION = "2026-02-20";

const TERMS_TEXT = [
  "1. はじめに",
  "本利用規約は、柔道整復施術所向け電子施術録（以下「本アプリ」）に適用される利用条件を定めるものです。配布者は田島京志郎です。本アプリをインストールまたは使用することで、本規約に同意したものとみなされます。",
  "",
  "2. サービスの提供",
  "本アプリはElectronアプリとして提供されます。無償提供のため、配布者は予告なく提供を終了できるものとします。また、更新の提供を保証するものではありません。",
  "",
  "3. 禁止行為",
  "利用者は、以下の行為を行ってはなりません：",
  "- 本アプリの再配布、転売、レンタル",
  "- 本アプリの改変",
  "- 本アプリのリバースエンジニアリング（法令で認められる範囲を除く）",
  "",
  "4. 利用者の責任",
  "利用者は、以下の責任を負います：",
  "- 患者情報の適切な管理とセキュリティ対策",
  "- データのバックアップおよびデータ復旧",
  "- 法令遵守（個人情報保護法、医療法等）",
  "- 本アプリの適切な使用",
  "",
  "5. 知的財産権",
  "本アプリおよび同梱物の知的財産権は配布者に帰属します。",
  "",
  "6. 情報の取扱い",
  "本アプリは初回セットアップ時に責任者情報を端末内に保存します。利用者データは端末内で管理され、外部サービスへ自動送信されません。詳細はプライバシーポリシーを参照してください。",
  "",
  "7. 医療情報システム",
  "本アプリは「医療情報システムの安全管理に関するガイドライン」を参照して設計されており、利用者が同ガイドラインに沿った運用を行うことを前提とします。",
  "",
  "8. 免責事項",
  "本アプリは「現状のまま」提供され、以下の事項について一切の責任を負いません：",
  "- データの損失、破損、漏洩",
  "- システムの不具合や障害",
  "- 利用者による不適切な使用に起因する損害",
  "- 本アプリを使用したことによる直接的・間接的な損害",
  "- 医療行為・診療記録の正確性に関する事項",
  "",
  "9. システム障害時の対応",
  "システム障害時は配布者に連絡できますが、対応を保証するものではありません。",
  "",
  "10. 契約の終了",
  "利用者はいつでも利用を停止でき、配布者は予告なく提供を終了できます。",
  "",
  "11. 準拠法",
  "本規約は日本法に準拠します。",
  "",
  "12. 規約の変更",
  "本規約は、予告なく変更される場合があります。変更内容は本ページで公開されます。重要な変更については、アプリ内で通知します。変更の適用時期は変更内容とともに本ページで明示します。",
  "",
  "13. お問い合わせ",
  "本規約に関するお問い合わせは、配布者（田島京志郎）宛にご連絡ください：vcharte378@gmail.com",
].join("\n");

const PRIVACY_TEXT = [
  "1. はじめに",
  "柔道整復施術所向け電子施術録（以下「本アプリ」）は、柔道整復施術所向けの電子施術録アプリです。本プライバシーポリシーは、本アプリにおける情報の取扱いを説明します。",
  "",
  "2. 配布者情報",
  "配布者名：田島京志郎",
  "連絡先：vcharte378@gmail.com",
  "",
  "3. 個人情報の取扱いについて",
  "本アプリはローカル端末内で動作し、患者情報や管理情報を外部サービスへ送信しません。",
  "",
  "4. 端末内に保存される情報",
  "本アプリは、業務に必要な情報を端末内データベースに保存します：",
  "- 患者情報・来院情報・施術記録",
  "- 管理者/スタッフ設定情報",
  "- バックアップ設定および運用確認情報",
  "重要：患者名、電話番号、住所、診療内容などの個人を特定できる情報は端末外へ送信されません。",
  "",
  "5. 情報の使用方法",
  "端末内に保存された情報は以下の目的で使用されます：",
  "- 施術録管理・認証・バックアップなどの機能提供",
  "- 監査ログや運用記録の保持",
  "- 利用者自身による院内運用管理",
  "",
  "6. 情報の共有",
  "本アプリ自体が外部送信を行うことはありません。第三者提供が必要な場合は、利用者の運用判断でエクスポート等を実施してください。",
  "",
  "7. データの保存場所",
  "本アプリはローカルで動作し、患者データは端末内に保存されます。配布者は患者データに直接アクセスすることはできません。",
  "",
  "8. セキュリティ対策",
  "本アプリでは、以下のセキュリティ対策を実施しています：",
  "- AES-256-GCM によるデータ暗号化",
  "- アクセス制御",
  "- アクセスログの記録",
  "",
  "9. データの保存期間",
  "端末内データの保存期間は、利用者の運用ポリシーおよび関連法令に従って管理してください。",
  "",
  "10. ユーザーの権利",
  "端末内データに対する開示・訂正・削除の対応は、利用者自身の管理責任のもとで実施されます。",
  "",
  "11. 外部送信について",
  "本OSS版は利用状況データの外部送信を行いません。",
  "",
  "12. お問い合わせ",
  "プライバシーに関するお問い合わせは、配布者（田島京志郎）宛にご連絡ください：vcharte378@gmail.com",
  "",
  "13. プライバシーポリシーの変更",
  "本プライバシーポリシーは、予告なく変更される場合があります。変更内容は本ページで公開されます。重要な変更については、アプリ内で通知します。変更の適用時期は変更内容とともに本ページで明示します。",
].join("\n");

function computeHash(text: string): string {
  return createHash("sha256").update(text, "utf8").digest("hex");
}

export function getTermsDocument(): ConsentDocument {
  return {
    version: TERMS_VERSION,
    hash: computeHash(TERMS_TEXT),
    text: TERMS_TEXT,
  };
}

export function getPrivacyDocument(): ConsentDocument {
  return {
    version: PRIVACY_VERSION,
    hash: computeHash(PRIVACY_TEXT),
    text: PRIVACY_TEXT,
  };
}

export { TERMS_VERSION, PRIVACY_VERSION };
